<%@ page language="java" pageEncoding="utf-8"%>
<%@ include file="/common/jsp/importtaglib.jsp"%>


<!-- 
	描述:${entityName}管理主界面。
	作者:$author
	版权:$company
	版本:$version 
	日期:$gendate
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>${entityName}管理</title>
<%@ include file="/common/jsp/css-lhgdialog.jsp"%>
<script type="text/javascript" src="${pageContext.request.contextPath}/html2/js/common.js"></script>
<script language="javascript">
				function senior()
				{
				    var senior=document.getElementById("senior")
				    var check=document.getElementById("check")
					senior.style.display="none"
				    if(check.checked)
				    {
				       senior.style.display="block";
				    }
				    else if(check.unchecked)
				    {
				       senior.style.display="none";
				    }
				}
			</script>
</head>
	<body>
		<div class="mcontent">
			<sany:menupath />
			#if($conditions && $conditions.size() > 0)
			<div id="searchblock">
				<div class="search_top">
					<div class="right_top"></div>
					<div class="left_top"></div>
				</div>
				
				<div class="search_box">
					<form id="queryForm" name="queryForm">
						<table width="100%" border="0" cellspacing="0" cellpadding="0">
							<tr>
								<td class="left_box"></td>
								<td>
									<table width="100%" border="0" cellpadding="0" cellspacing="0"
										class="table2">
									#if($conditions.size() <= 3)
										<tr>
											#foreach($condition in $conditions)
											<th>${condition.fieldName}：</th>
											<td><input id="${condition.fieldName}" name="${condition.fieldName}" type="text"
													value="" class="w120"/></td>
											#end
											<th>
												&nbsp;
											</th>
											<td>
												<a href="javascript:void(0)" class="bt_1" id="queryButton"><span>查询</span>
												</a>
												<a href="javascript:void(0)" class="bt_2" id="resetButton" onclick="doreset()"><span>重置</span>
												</a>
												<input type="reset" id="reset" style="display:none"/>
											</td>	
										</tr>
									#else
										<tr>
										#foreach($condition in $conditions)
										
											<th>${condition.fieldName}：</th>
											<td><input id="${condition.fieldName}" name="${condition.fieldName}" type="text"
													value="" class="w120"/></td>
											
											#if($velocityCount % 3 == 0)	
												#if($velocityCount == ($conditions.size() - 1))
											<th>
												&nbsp;
											</th>
											<td>
												<a href="javascript:void(0)" class="bt_1" id="queryButton"><span>查询</span>
												</a>
												<a href="javascript:void(0)" class="bt_2" id="resetButton" onclick="doreset()"><span>重置</span>
												</a>
												<input type="reset" id="reset" style="display:none"/>
											</td>	
												#end
										</tr>
												#if($velocityCount < $conditions.size())
										<tr>		
												#end
											#elseif($velocityCount == ($conditions.size() - 1))
											<th>
												&nbsp;
											</th>
											<td>
												<a href="javascript:void(0)" class="bt_1" id="queryButton"><span>查询</span>
												</a>
												<a href="javascript:void(0)" class="bt_2" id="resetButton" onclick="doreset()"><span>重置</span>
												</a>
												<input type="reset" id="reset" style="display:none"/>
											</td>
										</tr>	
											#end
										#end	
									#end
									</table>
								</td>
								<td class="right_box"></td>
							</tr>
						</table>
					</form>
				</div>
				<div class="search_bottom">
					<div class="right_bottom"></div>
					<div class="left_bottom"></div>
				</div>
			</div>
			#end
			<div class="title_box">
				<div class="rightbtn">
				<a href="javascript:void" class="bt_small" id="addButton"><span>新增</span></a>
				<a href="javascript:void" class="bt_small" id="delBatchButton"><span>批量删除</span></a>
				<a href="javascript:void" class="bt_small" id="exportButton"><span>导出</span></a>
				<input id="excelType" type="radio" name="excelType"   checked  >2003</input>
				<input  type="radio" name="excelType"  >2007</input>
				</div>
				
				<strong>${entityName} 列表</strong>
				<img id="wait" src="../common/images/wait.gif" />				
			</div>
			<div id="custombackContainer" style="overflow:auto">
			
			</div>
		</div>
	</body>
</html>
<script type="text/javascript">

<!--

$(document).ready(function() {
	bboss.pager.pagerevent = {   
			                            beforeload:function(opt){   
			                                alert("beforeload containerid:"+opt.containerid);   
			                            },   
			                          afterload:function(opt){   
			                              alert("afterload containerid:"+opt.containerid);   
	}};   

	 $("#wait").hide();
	 queryList();

  $("#CKA").click(function() {
        $("#tb tr:gt(1)").each(function() {
            $(this).find("#CK").get(0).checked = $("#CKA").get(0).checked;
        });
    });
    $('#queryButton').click(function() {
    	queryData();
    });
    $('#delBatchButton').click(function() {
    	delBatch();
    });
    $('#exportButton').click(function() {
    	exportExcel();
    });           
    
    $('#addButton').click(function() {  
  	 var url="<%=request.getContextPath()%>${toAddAction}";
	 	 $.dialog({ id:'iframeNewId', title:'新增&nbsp;${entityName}',width:740,height:560, content:'url:'+url});   			 		  
    });            
});

function queryList(){	
	$("#custombackContainer").load("queryListAppBom.page #customContent",function(){})
}
function exportExcel(){	 
	var bm=$("#bm_query").val();
	var app_name_en=$("#app_name_en_query").val();
	var app_name=$("#app_name_query").val();
	var soft_level=$("#soft_level_query").val();
	var state=$("#state_query").val();
	var rd_type=$("#rd_type_query").val();
	var excelType="";
	if($("#excelType").attr("checked")){
		excelType=0;
	}
	else{
		excelType=1;
	} 	
	if(containSpecial(bm)|| containSpecial(app_name_en)||containSpecial(app_name)){
		alert("查询字符串含有非法字符集,请检查输入条件");
		return;
	}

	 window.location.href="exportExcel.page?bm="+encodeURI(encodeURI(bm))+"&app_name="+encodeURI(encodeURI(app_name))+"&app_name_en="+encodeURI(encodeURI(app_name_en))
		+"&soft_level="+soft_level+"&state="+state+"&rd_type="+rd_type+"&excelType="+excelType;
	 return;

}	
function containSpecial( s ) {  
	  var containSpecial = RegExp(/[(\ )(\~)(\!)(\@)(\#)(\$)(\%)(\^)(\&)(\+)(\=)(\[)(\])(\{)(\})(\|)(\\)(\;)(\:)(\')(\")(\,)(\/)(\<)(\>)(\?)(\)]+/);      
   return ( containSpecial.test(s) );      
}

//查找
function queryData()
{	var bm=$("#bm_query").val();
	var app_name_en=$("#app_name_en_query").val();
	var app_name=$("#app_name_query").val();
	var soft_level=$("#soft_level_query").val();
	var state=$("#state_query").val();
	var rd_type=$("#rd_type_query").val();
	if(containSpecial(bm)|| containSpecial(app_name_en)||containSpecial(app_name)){
		$.dialog.alert('查询字符串含有非法字符集,请检查输入条件！');
		return;
	}
	$("#custombackContainer").load("queryListAppBom.page #customContent",
	{bm:bm,app_name_en: app_name_en,app_name:app_name,soft_level:soft_level,
	state:state,rd_type:rd_type},function(){loadjs()});


}

function modifyQueryData()
{	
	$("#custombackContainer").load("queryListAppBom.page?"+$("#querystring").val()+" #customContent");
}
function editBom(id){
	var url="<%=request.getContextPath()%>/appbom/updatePre.page?id="+id;
	$.dialog({ title:'修改台账信息',width:740,height:560, content:'url:'+url,lock: true}); 		
}
function viewBom(id){
	var url="<%=request.getContextPath()%>/appbom/viewBom.page?id="+id;		
	$.dialog({ title:'查看台账信息',width:740,height:560, content:'url:'+url,lock: true}); 	
}
function doreset(){
	$("#reset").click();
}
function delBom(id){		
	$.dialog.confirm('<pg:message code="sany.pdp.common.operation.remove.confirm"/>', function(){ 
		 $.ajax({
	 	 type: "POST",
		url : "<%=request.getContextPath()%>/appbom/delete.page",
		data :{"id":id},
		dataType : 'json',
		async:false,
		beforeSend: function(XMLHttpRequest){
			 	XMLHttpRequest.setRequestHeader("RequestType", "ajax");
			},
		success : function(data){
	 		modifyQueryData();
	 		//alert("成功删除记录");
		}	
	  });
	}, function(){ 
		 
	});
		
	  
}
function delBatch(){
	var ids="";
	 $("#tb tr:gt(0)").each(function() {
	 
            if ($(this).find("#CK").get(0).checked == true) {
                ids=ids+$(this).find("#id").val()+",";
              	}
       });
       if(ids==""){
        $.dialog.alert('请选择需要删除的记录！');
        return false;
       }
     $.dialog.confirm('<pg:message code="sany.pdp.common.operation.remove.confirm"/>', function(){
     	$.ajax({
		 	 	type: "POST",
				url : "<%=request.getContextPath()%>/appbom/deletebatch.page",
				data :{"ids":ids},
				dataType : 'json',
				async:false,
				beforeSend: function(XMLHttpRequest){
					 	XMLHttpRequest.setRequestHeader("RequestType", "ajax");
					},
				success : function(data){
			 		modifyQueryData();
			 		//alert("成功删除记录");
				}	
			 });
      },function(){
      		
      });         
}

//-->
</script>
